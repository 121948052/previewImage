!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("previewImage requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e){var t={},i="#__previewImage-container{-ms-touch-action:none;touch-action:none;-webkit-touch-action:none;line-height:100vh;background-color:#000;width:100%;height:100%;position:fixed;overflow:hidden;top:0;left:0;z-index: 2147483647;transition:transform .3s;-ms-transition:transform .3s;-moz-transition:transform .3s;-webkit-transition:transform .3s;-o-transition:transform .3s;transform:translate3d(100%,0,0);-webkit-transform:translate3d(100%,0,0);-ms-transform:translate3d(100%,0,0);-o-transform:translate3d(100%,0,0);-moz-transform:translate3d(100%,0,0)}#__previewImage-container .previewImage-text{height:1em;width:100%;position:absolute;top:.4em;text-align:center;font-size:3vh;line-height:3vh;color:#fff;z-index:10}#__previewImage-container .previewImage-box{width:999999rem;height:100%}#__previewImage-container .previewImage-box .previewImage-item{width:100vw;height:100vh;margin-right:15px;float:left;text-align:center;background:url(http://static.luyanghui.com/svg/oval.svg) no-repeat center/auto}#__previewImage-container .previewImage-box .previewImage-item .previewImage-image{vertical-align:middle;width:100%}";t.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},t.all=function(e,t){var i,s=[];return i=t?t.querySelectorAll(e):document.querySelectorAll(e),i&&i.length>0&&(s=Array.prototype.slice.call(i)),s},t.delegate=function(e,i,s,a){e&&e.addEventListener(i,function(i){var n=t.all(s,e);if(n)for(var h=0;h<n.length;h++)for(var o=i.target;o;){if(o==n[h]){a.call(o,i);break}if(o=o.parentNode,o==e)break}},!1)};var s=function(){this.winw=e.innerWidth||document.body.clientWidth,this.winh=e.innerHeight||document.body.clientHeight,this.marginRight=15,this.imageChageMoveX=this.marginRight+this.winw,this.imageChageNeedX=Math.floor(.5*this.winw),this.prefix=["","webkit","Moz","ms","o"],this.imgLoadCache=new Object,this.scale=1,this.maxScale=4,this.maxOverScale=6,this.openTime=.3,this.slipTime=.5,this.$box=!1;var t=document.createElement("style");t.innerText=i,this.$container=document.createElement("div"),this.$container.id="__previewImage-container",this.$container.style.width=this.winw+"px",this.$container.style.height=this.winh+"px",document.body.appendChild(this.$container),document.head.appendChild(t),this.bind()};return s.prototype.start=function(e){var i=e.urls,s=e.current;if(this.$container.innerHTML="",!i||!t.isArray(i)||0==i.length)throw new Error("urls must be a Array and the minimum length more than zero");if(s){var a=i.indexOf(s);0>a&&(a=0,console.warn("current isnot on urls,it will be the first value of urls!")),this.index=a}else this.index=0,console.warn("current is empty,it will be the first value of urls!");this.urls=i,this.maxLen=i.length-1,this.cIndex=this.maxLen+1,this.bIndex=this.maxLen+2,this.maxOverWidthPercent=.5,this.imgStatusCache=new Object,this.render()},s.prototype.render=function(){var t=this;if(this.$box===!1){var i=document.createElement("div");i.className+="previewImage-box",this.$box=i}else this.$box.innerHTML="";var s=document.createElement("div");this.$text=s,this.$text.className+="previewImage-text",this.$text.innerText=this.index+1+"/"+(this.maxLen+1),this.container=this.imgStatusCache[this.cIndex]={elem:this.$container,x:this.winw,y:0,m:0,my:0,scale:1,scalem:1},this.box=this.imgStatusCache[this.bIndex]={elem:this.$box,x:0,y:0,m:0,my:0,scale:1,scalem:1},this.urls.forEach(function(i,s){var a,n=document.createElement("div"),h=e.md5?md5(i+s):i+s,o=t.imgLoadCache[h];o&&o.isload?a=o.elem:(a=new Image,a.className+="previewImage-image",t.imgLoadCache[h]={isload:!1,elem:a},s==t.index&&(a.src=i,a.onload=function(){t.imgLoadCache[h].isload=!0})),t.imgStatusCache[s]={hash:h,x:0,m:0,y:0,my:0,scale:t.scale,scalem:1},a.setAttribute("data-index",s),n.className+="previewImage-item",n.appendChild(a),t.$box.appendChild(n)}),this.$container.appendChild(this.$box),this.$container.appendChild(this.$text);var a=-this.imageChageMoveX*this.index;this.box.x=a,this.container.x=0,setTimeout(function(){t.translateScale(t.bIndex,0),t.translateScale(t.cIndex,t.openTime)},50)},s.prototype.bind=function(){var e=this.$container,i=this,s=function(){i.closePreview.call(i)},a=function(){i.touchStartFun.call(i)},n=function(){i.touchMoveFun.call(i)},h=function(){i.touchEndFun.call(i)};t.delegate(e,"click",".previewImage-item",s),t.delegate(e,"touchstart",".previewImage-item",a),t.delegate(e,"touchmove",".previewImage-item",n),t.delegate(e,"touchend",".previewImage-item",h),t.delegate(e,"touchcancel",".previewImage-item",h)},s.prototype.closePreview=function(){this.imgStatusCache[this.cIndex].x=this.winw,this.translateScale(this.cIndex,this.openTime),this.imgStatusRewrite(),this.translateScale(this.index,this.slipTime)},s.prototype.touchStartFun=function(e){this.ts=this.getTouches(),this.allowMove=!0},s.prototype.touchMoveFun=function(e){this.tm=this.getTouches();var t=this.tm,i=this.ts;this.moveAction(i,t)},s.prototype.touchEndFun=function(e){this.$container;this.te=this.getTouches(),this.endAction(this.ts,this.te)},s.prototype.moveAction=function(e,t){if(this.allowMove){var i=this.getIndexImage(),s=.3*this.winw/i.scale,a=t.x0-e.x0,n=t.y0-e.y0;Math.abs(n)>0&&event.preventDefault();var h=i.x+a,o=i.y+n,r=this.getAllow(this.index),l=this.allowX=r.x,c=this.allowY=r.y;if(0>=a&&(this.allowX=-l),0>=n&&(this.allowY=-c),this.statusX=0,this.statusY=0,1==t.length)if(i.scale>1){if(c>0)if(o>=c){this.statusY=1,this.YY=1;var m=o-c;i.my=c-i.y+this.getSlowlyNum(m,s)}else if(-c>=o){this.statusY=1,this.YY=2;var m=o+c;i.my=-c-i.y+this.getSlowlyNum(m,s)}else this.statusY=2,i.my=n;if(0>a&&i.x<=-l)this.statusX=1,this.box.m=a,this.index==this.maxLen&&(this.box.m=this.getSlowlyNum(a)),this.translateScale(this.bIndex,0),this.translateScale(this.index,0);else if(a>0&&i.x>=l)this.statusX=2,this.box.m=a,0==this.index&&(this.box.m=this.getSlowlyNum(a)),this.translateScale(this.bIndex,0),this.translateScale(this.index,0);else{if(0==a)return;if(this.statusX=3,i.m=a,h>=l){this.statusX=4;var d=h-l;i.m=l-i.x+this.getSlowlyNum(d,s)}if(-l>=h){this.statusX=4;var d=h+l;i.m=-l-i.x+this.getSlowlyNum(d,s)}this.translateScale(this.index,0)}}else this.statusX=5,0==this.index&&a>0||this.index==this.maxLen&&0>a?this.box.m=this.getSlowlyNum(a):this.box.m=a,this.translateScale(this.bIndex,0);else{var x=this.getScale(e,t),u=x*i.scale;if(u>=this.maxScale){var g=u-this.maxScale;u=this.maxScale+this.getSlowlyNum(g,this.maxOverScale),x=u/i.scale}i.scalem=x,this.translateScale(this.index,0)}}},s.prototype.endAction=function(e,t){var i=this.getIndexImage(),s=t.x0-e.x0,a=(t.y0-e.y0,t.time-e.time),n=0;if(this.allowMove=!1,1==e.length){switch(Math.abs(s)>10&&event.preventDefault(),this.statusY){case 1:i.y=this.allowY,i.my=0,n=this.slipTime;break;case 2:i.y=i.y+i.my,i.my=0}switch(this.statusX){case 1:this.index!=this.maxLen&&(s<=-this.imageChageNeedX||200>a&&-30>s)?this.changeIndex(1):(this.changeIndex(0),0!=n&&this.translateScale(this.index,n));break;case 2:0!=this.index&&(s>=this.imageChageNeedX||200>a&&s>30)?this.changeIndex(-1):(this.changeIndex(0),0!=n&&this.translateScale(this.index,n));break;case 3:i.x=i.x+i.m,i.m=0,this.translateScale(this.index,n);break;case 4:i.x=this.allowX,i.m=0,n=this.slipTime,this.translateScale(this.index,n);break;case 5:s>=this.imageChageNeedX||200>a&&s>30?this.changeIndex(-1):s<=-this.imageChageNeedX||200>a&&-30>s?this.changeIndex(1):this.changeIndex(0)}}else{event.preventDefault();var h=i.scale*i.scalem,o=this.getJqElem(this.index);i.scale=h;var r=this.getAllow(this.index);i.x>r.x?(n=this.slipTime,i.x=r.x):i.x<-r.x&&(n=this.slipTime,i.x=-r.x),i.y>r.y?(n=this.slipTime,i.y=r.y):i.y<-r.y&&(n=this.slipTime,i.y=-r.y),o.height*i.scale<=this.winh&&(i.y=0),o.width*i.scale<=this.winw&&(i.x=0),i.scalem=1,h>this.maxScale?(i.scale=this.maxScale,n=this.slipTime):1>h&&(this.imgStatusRewrite(),n=this.slipTime),0!=n&&(this.changeIndex(0),this.translateScale(this.index,n))}},s.prototype.getAllow=function(e){var t=this.getJqElem(e),i=this.getIndexImage(e),s=Math.floor((t.width*i.scale-this.winw)/(2*i.scale)),a=Math.floor((t.height*i.scale-this.winh)/(2*i.scale));return{x:s,y:a}},s.prototype.getSlowlyNum=function(e,t){var t=t||this.winw*this.maxOverWidthPercent;return 0>e?(e=-e,-(1-e/(t+e))*e):(1-e/(t+e))*e},s.prototype.getScale=function(e,t){var i=Math.sqrt(Math.pow(e.x1-e.x0,2)+Math.pow(e.y1-e.y0,2)),s=Math.sqrt(Math.pow(t.x1-t.x0,2)+Math.pow(t.y1-t.y0,2)),a=s/i;return a},s.prototype.imgStatusRewrite=function(e){var e=void 0===e?this.index:e,t=this.imgStatusCache[e];t.x=0,t.y=0,t.m=0,t.my=0,t.scale=1,t.scalem=1,e!=this.index&&this.translateScale(e,this.slipTime)},s.prototype.changeIndex=function(e){var t=(this.getIndexImage(),this.index);if(0==this.index&&-1==e)this.index=this.index;else if(this.index==this.maxLen&&1==e)this.index=this.index;else{this.index+=e,this.$text.innerText=this.index+1+"/"+(this.maxLen+1);var i=this.imgStatusCache[this.index].hash,s=this.imgLoadCache[i];s.isload||(s.elem.src=this.urls[this.index],s.elem.onload=function(){s.isload=!0})}this.box.x=-this.imageChageMoveX*this.index,this.box.m=0,t!=this.index&&this.imgStatusRewrite(t),this.translateScale(this.bIndex,this.slipTime)},s.prototype.getIndexImage=function(e){var e=void 0==e?this.index:e;return this.imgStatusCache[this.index]},s.prototype.translateScale=function(e,t){var i=this.imgStatusCache[e];$elem=this.getJqElem(e);var s=i.scale*i.scalem,a=i.x+i.m,n=i.y+i.my,h="scale3d("+s+","+s+",1)  translate3d("+a+"px,"+n+"px,0px)",o="transform "+t+"s ease-out";this.addCssPrefix($elem,"transition",o),this.addCssPrefix($elem,"transform",h)},s.prototype.getJqElem=function(e){var t,e=void 0==e?this.index:e;if(e<=this.maxLen){var i=this.imgStatusCache[e].hash,s=this.imgLoadCache[i].elem;t=s}else{var a=this.imgStatusCache[e].elem;t=a}return t},s.prototype.addCssPrefix=function(e,t,i){for(var s in this.prefix){var a=this.prefix[s];if(""===a)t=t.toLowerCase();else{var n=t.length;t=t.substr(0,1).toUpperCase()+t.substr(1,n).toLowerCase()}if(void 0!==document.body.style[t])return void(e.style[t]=i)}},s.prototype.getTouches=function(e){var t=event.touches.length>0?event.touches:event.changedTouches,i={touches:t,length:t.length};return i.x0=t[0].pageX,i.y0=t[0].pageY,i.time=(new Date).getTime(),t.length>=2&&(i.x1=t[0].pageX,i.y1=t[1].pageY),i},e.previewImage=new s,"function"==typeof define&&define.amd&&define("previewImage",[],function(){return previewImage}),previewImage});